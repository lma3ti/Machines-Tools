<%- include('parts/top.ejs') %>
<br><br><br>
<div class="container-fluid mt-5">
    <div class="row">
        <!-- Sidebar (CatÃ©gories) -->
        <div class="col-md-3 sidebar">
            <h4 class="text-center">Categories</h4>
            <div class="list-group">
                <a href="#" class="list-group-item list-group-item-action active" data-category="all">All Categories</a>
                <% Object.keys(productsByCategory).forEach(category => { %>
                    <a href="#" class="list-group-item list-group-item-action" data-category="<%= category %>"><%= category %></a>
                <% }) %>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="col-md-9 main-content">
            <div class="search-bar mb-4">
                <input type="text" id="searchInput" placeholder="Search products..." class="form-control">
            </div>

            <% if (productsByCategory && Object.keys(productsByCategory).length > 0) { %>
                <% for (let category in productsByCategory) { %>
                    <h2 class="mt-4 mb-3 category-title category-section" data-category="<%= category %>"><%= category %></h2>
                    <div class="row product-grid category-section" data-category="<%= category %>">
                        <% productsByCategory[category].forEach(product => { %>
                            <div class="col-md-4 product-card" data-category="<%= category %>">
                                <div class="card shadow-sm">
                                    <img src="/uploads/<%= product.image %>" class="card-img-top img-fluid" alt="<%= product.title %>">
                                    <div class="card-body">
                                        <h5 class="card-title"><%= product.title %></h5>
                                        <p class="card-text"><%= product.description %></p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="product-price">$<%= product.price %></span>
                                            <a href="#" class="btn btn-primary"><i class="zmdi zmdi-shopping-basket"></i> Buy</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } %>
            <% } else { %>
                <p class="text-center mt-5">No products available.</p>
            <% } %>
        </div>
    </div>
</div>

<%- include('parts/buttom.ejs') %>

<script>
    document.getElementById("searchInput").addEventListener("input", filterProducts);
    
    document.querySelectorAll(".list-group-item").forEach(item => {
        item.addEventListener("click", function(event) {
            event.preventDefault();

            // Changer la classe active
            document.querySelectorAll(".list-group-item").forEach(link => link.classList.remove("active"));
            this.classList.add("active");

            let selectedCategory = this.getAttribute("data-category");
            filterProducts(selectedCategory);
        });
    });

    function filterProducts(selectedCategory = null) {
        let searchText = document.getElementById("searchInput").value.toLowerCase();
        selectedCategory = selectedCategory || document.querySelector(".list-group-item.active").getAttribute("data-category");

        document.querySelectorAll(".product-card").forEach(card => {
            let title = card.querySelector(".card-title").textContent.toLowerCase();
            let category = card.getAttribute("data-category");

            let matchesSearch = title.includes(searchText);
            let matchesCategory = selectedCategory === "all" || category === selectedCategory;

            card.style.display = matchesSearch && matchesCategory ? "block" : "none";
        });

        document.querySelectorAll(".category-section").forEach(section => {
            let category = section.getAttribute("data-category");
            let visibleProducts = document.querySelectorAll(`.product-card[data-category="${category}"]:not([style*="display: none"])`);

            section.style.display = (selectedCategory === "all" || category === selectedCategory) && visibleProducts.length > 0 ? "block" : "none";
        });
    }
</script>

<style>
    /* Sidebar */
    .sidebar {
        position: sticky;
        top: 80px;
        height: calc(100vh - 80px);
        overflow-y: auto;
        background: #f8f9fa;
        padding: 20px;
        border-right: 2px solid #ddd;
    }
    
    .list-group-item {
        cursor: pointer;
        border-radius: 5px;
        margin-bottom: 5px;
    }
    
    .list-group-item.active {
        background-color: #007bff;
        color: white;
        font-weight: bold;
    }

    /* Main Content */
    .main-content {
        padding-left: 30px;
    }

    /* Products */
    .product-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
    }

    .product-card {
        max-width: 350px;
    }

    .card {
        border-radius: 10px;
        transition: transform 0.2s ease-in-out;
    }

    .card:hover {
        transform: scale(1.05);
    }

    .product-price {
        font-size: 1.2rem;
        font-weight: bold;
        color: #007bff;
    }

    .category-title {
        border-bottom: 2px solid #007bff;
        display: inline-block;
        padding-bottom: 5px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .sidebar {
            position: relative;
            height: auto;
            border-right: none;
        }

        .main-content {
            padding-left: 0;
        }
    }
</style>
